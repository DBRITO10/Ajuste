
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>RECEBIMENTO/SIMONETTI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Libs -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/fixedheader/3.3.2/js/dataTables.fixedHeader.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <!-- CSS DataTables -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />
  <link
    rel="stylesheet"
    href="https://cdn.datatables.net/fixedheader/3.3.2/css/fixedHeader.dataTables.min.css"
  />

  <style>
    :root {
      --cor-fundo-dashboard: #1e1e2f;
      --cor-cabecalho: linear-gradient(90deg, #00c6ff, #0072ff);
      --cor-texto-cabecalho: #ffffff;
      --cor-linha-par: #2b2b40;
      --cor-linha-impar: #242437;
      --cor-filtro: #3a3a5a;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--cor-fundo-dashboard);
      color: white;
      padding: 20px;
    }

    h1 {
      margin-bottom: 20px;
      color: #ffffff;
      font-size: 24px;
    }

    table {
      width: 100%;
      font-size: 14px;
      border-collapse: collapse;
    }

    thead tr th {
      background: var(--cor-cabecalho);
      color: var(--cor-texto-cabecalho);
      padding: 8px;
      text-align: center;
      font-weight: bold;
    }

    tbody tr:nth-child(even) {
      background-color: var(--cor-linha-par);
    }

    tbody tr:nth-child(odd) {
      background-color: var(--cor-linha-impar);
    }

    td {
      padding: 8px 12px;
      border-bottom: 1px solid #444;
      white-space: nowrap;
    }

    thead tr.filters th {
      background: #2b2b40;
      padding: 4px;
    }

    .filter-select {
      width: 100%;
      padding: 4px;
      font-size: 12px;
      background: var(--cor-filtro);
      border: none;
      border-radius: 4px;
      color: #eee;
    }

    table.dataTable th,
    table.dataTable td {
      min-width: 140px;
    }

    div.dataTables_wrapper {
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>RECEBIMENTO/SIMONETTI</h1>
  <table id="planilha" class="display nowrap">
    <thead>
      <tr class="headers"></tr>
      <tr class="filters"></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const sheetID = "1LaYf3GKID_HdueUpZax7J_aco2-a1UVFBz1pZ4CkUGk";
    const gid = "0";
    const csvUrl = `https://docs.google.com/spreadsheets/d/${sheetID}/export?format=csv&gid=${gid}`;

    const colunasDesejadas = [
      "SENHA",
      "DATA",
      "CENTRAL",
      "CARGA/TRANSPORTE",
      "NOTAS",
      "STATUS DA CARGA",
      "FORNECEDOR",
      "TIPO DE PRODUTO"
    ];

    Papa.parse(csvUrl, {
      download: true,
      header: true,
      complete: function (results) {
        const data = results.data;

        if (!data.length || Object.keys(data[0]).length === 0) {
          alert("Falha ao carregar dados.");
          return;
        }

        results.meta.fields = results.meta.fields.map(f => f.trim());

        data.forEach(row => {
          Object.keys(row).forEach(k => {
            if (k !== k.trim()) {
              row[k.trim()] = row[k];
              delete row[k];
            }
          });
        });

        data.forEach(row => {
          colunasDesejadas.forEach(col => {
            if (row[col]) row[col] = row[col].trim();
          });
        });

        const headers = Object.keys(data[0]);
        const headerRow = document.querySelector("#planilha thead tr.headers");
        const filterRow = document.querySelector("#planilha thead tr.filters");
        const tableBody = document.querySelector("#planilha tbody");

        colunasDesejadas.forEach(col => {
          if (headers.includes(col)) {
            headerRow.innerHTML += `<th>${col}</th>`;
            filterRow.innerHTML += `<th><select class="filter-select"><option value="">Filtrar</option></select></th>`;
          }
        });

        data.forEach(row => {
          let rowHtml = "<tr>";
          colunasDesejadas.forEach(col => {
            let valor = row[col] || "";
            if (col === "NOTAS" && valor === "") {
              valor = "Sem nota";
            }
            rowHtml += `<td>${valor}</td>`;
          });
          rowHtml += "</tr>";
          tableBody.innerHTML += rowHtml;
        });

        const table = $("#planilha").DataTable({
          paging: false,
          searching: true,
          info: false,
          scrollX: true,
          fixedHeader: true
        });

        table.columns().every(function (i) {
          const column = this;
          const select = $(filterRow).find("select").eq(i);

          const uniqueData = [];
          column.data().unique().sort().each(function (d) {
            let val = d.trim();
            if (val === "" && colunasDesejadas[i] === "NOTAS") {
              val = "Sem nota";
            }
            if (!uniqueData.includes(val)) uniqueData.push(val);
          });

          uniqueData.forEach(val => {
            select.append(`<option value="${val}">${val}</option>`);
          });

          select.on("change", function () {
            const val = $.fn.dataTable.util.escapeRegex($(this).val());
            column.search(val ? "^" + val + "$" : "", true, false).draw();
          });
        });
      }
    });
  </script>
</body>
</html>
